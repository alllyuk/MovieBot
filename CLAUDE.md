# CLAUDE.md

Документ описывает процесс разработки MovieBot с использованием AI-ассистента (Claude Code).

## О проекте

**MovieBot** — Telegram-бот для совместного выбора фильмов. Помогает парам и семьям вести списки желаемых фильмов, находить пересечения и выбирать что посмотреть вместе.

## Подход к разработке

### BDD-First (Behavior-Driven Development)

Весь проект разрабатывался по принципу "тесты до кода":

1. **Сначала .feature файлы** — описание поведения на человеческом языке
2. **Затем step definitions** — связывание сценариев с кодом
3. **Потом реализация** — код, который проходит тесты

Это позволило:
- Иметь чёткую спецификацию до написания кода
- Не писать лишний функционал
- Сразу видеть, когда фича готова

### Роль AI в разработке

Claude Code использовался как **соавтор**, а не просто генератор кода:

- **Обсуждение архитектуры** — выбор слоёв (handlers → services → repositories)
- **Написание BDD сценариев** — формулировка на русском языке
- **Генерация кода** — по готовым спецификациям
- **Отладка** — поиск и исправление проблем с кодировкой, aiogram API
- **Рефакторинг** — улучшение качества без изменения поведения

### Принципы работы с AI

1. **Описывать задачу, не решение** — "нужен выбор фильма из пересечения списков", а не "сделай функцию X"
2. **Итеративность** — маленькие шаги с проверкой после каждого
3. **Контроль качества** — AI предлагает, человек проверяет и одобряет
4. **Понятный код** — простота важнее "умных" решений

## Эволюция проекта

| Этап | Коммиты | Что сделано |
|------|---------|-------------|
| Инициализация | 1-2 | Структура проекта, зависимости |
| Спецификация | 3 | BDD сценарии для всего MVP |
| База данных | 4-5 | Схема SQLite, репозитории |
| Бизнес-логика | 6 | Сервисы: wishlist, selection, history |
| Тесты | 7-8 | Step definitions, фикстуры |
| Telegram | 9-11 | Обработчики команд, запуск бота |
| Улучшения | 12-18 | UX, клавиатура, баги, качество тестов |

## Структура кода

```
src/
├── bot/
│   ├── handlers.py      # Тонкий слой — только парсинг и ответы
│   └── messages.py      # Текстовые сообщения бота
├── services/
│   ├── wishlist_service.py    # Управление списками
│   ├── selection_service.py   # Выбор фильма
│   └── history_service.py     # История просмотров
├── database/
│   ├── schema.py        # DDL для SQLite
│   ├── connection.py    # Подключение к БД
│   └── repositories.py  # CRUD операции
└── main.py              # Точка входа
```

## Команды

```bash
# Установка
pip install -r requirements.txt

# Тесты
pytest tests/ -v

# Запуск бота
python -m src.main
```

## Выводы

Vibe Coding с AI эффективен когда:
- Есть чёткое понимание, что нужно построить
- Используется BDD для фиксации требований
- Работа идёт итеративно с частыми коммитами
- Человек остаётся "водителем", AI — "штурманом"
