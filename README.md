# MovieBot

Telegram-бот для выбора фильмов на вечер. Помогает парам/семьям вести списки желаемых фильмов и выбирать что посмотреть вместе.

## Возможности

- Каждый ведёт свой список "хочу посмотреть"
- Бот находит пересечение списков (фильмы которые хотят все)
- Случайный выбор из пересечения или общего списка
- История просмотров с оценками
- Умный выбор: не предлагает просмотренные и не повторяет последний

## Команды

| Команда | Описание |
|---------|----------|
| `/start` | Начать работу с ботом |
| `/help` | Показать справку |
| `хочу посмотреть [название]` | Добавить фильм |
| `мой список` | Показать свой список |
| `наш список` | Фильмы которые хотят все |
| `что смотрим?` | Выбрать фильм на вечер |
| `посмотрели [название], [оценка]` | Отметить просмотр |
| `история` | История просмотров |
| `удали [название]` | Удалить из списка |

## Технический стек

- **Python 3.10+**
- **aiogram 3.x** - Telegram Bot API
- **SQLite** - хранение данных
- **pytest-bdd** - BDD тестирование

## Архитектура

```
src/
├── bot/handlers/    # Обработчики команд (тонкий слой)
├── services/        # Бизнес-логика (без зависимости от Telegram)
├── database/        # SQLite + репозитории
└── utils/           # Парсер команд, форматирование дат
```

## Установка и запуск

### 1. Создание бота в Telegram

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Придумайте имя для бота (например, "Movie Night Bot")
4. Придумайте username (должен заканчиваться на `bot`, например `my_movie_night_bot`)
5. BotFather пришлёт токен — сохраните его

### 2. Клонирование репозитория

```bash
git clone https://github.com/alllyuk/MovieBot.git
cd MovieBot
```

### 3. Создание виртуального окружения

**Windows:**
```bash
python -m venv .venv
.venv\Scripts\activate
```

**Linux/Mac:**
```bash
python3 -m venv .venv
source .venv/bin/activate
```

После активации в начале строки терминала появится `(.venv)`.

### 4. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 5. Настройка переменных окружения

**Windows:**
```bash
copy .env.example .env
```

**Linux/Mac:**
```bash
cp .env.example .env
```

Откройте файл `.env` в текстовом редакторе и вставьте токен от BotFather:

```
BOT_TOKEN=ваш_токен_от_BotFather
```

### 6. Запуск бота

```bash
python -m src.main
```

Если всё настроено правильно, вы увидите:
```
INFO - Initializing database at moviebot.db
INFO - Starting MovieBot...
```

Теперь найдите вашего бота в Telegram и отправьте `/start`!

## Тестирование

```bash
# Все тесты
pytest tests/ -v

# С покрытием
pytest tests/ --cov=src
```

## Лицензия

MIT
